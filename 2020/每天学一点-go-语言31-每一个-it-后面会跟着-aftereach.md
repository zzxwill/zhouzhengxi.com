---
title: "每天学一点 Go 语言|31. 每一个 It 后面会跟着 AfterEach"
date: "2020-11-23"
---

### It and AfterEach

\[\[code\]\]czoxNzY4OlwiQ29udGV4dChcXFwiQXR0YWNoIGEgcmV2aXNpb24tZW5hYmxlIHRyYWl0IHRoZSBmaXJzdCB0aW1lLCB3b3JrbG9hZCBzaHtbJiomXX1vdWxkIG5vdCBiZSByZWNyZWF0ZWRcXFwiLCBmdW5jKCkgewoJCUl0KFxcXCJzaG91bGQgY3JlYXRlIENvbXBvbmVudCBhbmQgQXBwbGljYXtbJiomXX10aW9uQ29uZmlndXJhdGlvblxcXCIsIGZ1bmMoKSB7CgkJCUJ5KFxcXCJzdWJtaXQgQXBwbGljYXRpb25Db25maWd1cmF0aW9uXFxcIikKCQkJe1smKiZdfUV4cGVjdChrOHNDbGllbnQuQ3JlYXRlKGN0eCwgJmFtcDtjb21wb25lbnQpKS5TaG91bGQoU3VjY2VlZCgpKQoJCQlFeHBlY3Qoazh7WyYqJl19c0NsaWVudC5DcmVhdGUoY3R4LCAmYW1wO2FwcENvbmZpZykpLlNob3VsZChTdWNjZWVkKCkpCgoJCQlCeShcXFwiY2hlY2sgd29ya2xve1smKiZdfWFkXFxcIikKCQkJdmFyIGRlcGxveSB2MS5EZXBsb3ltZW50CgkJCUV2ZW50dWFsbHkoCgkJCQlmdW5jKCkgZXJyb3IgewoJCQkJCXJldHtbJiomXX11cm4gazhzQ2xpZW50LkdldChjdHgsIHdvcmtsb2FkT2JqS2V5LCAmYW1wO2RlcGxveSkKCQkJCX0sCgkJCQl0aW1lLlNlY29uZCoxe1smKiZdfTUsIHRpbWUuTWlsbGlzZWNvbmQqNTAwKS5TaG91bGQoQmVOaWwoKSkKCQkvL30pCgkJLy8KCQkvL0l0KFxcXCJ3b3JrbG9hZCBzaG91bHtbJiomXX1kIG5vdCBiZSByZWNyZWF0ZWRcXFwiLCBmdW5jKCkgewoJCS8vCUJ5KFxcXCJzdWJtaXQgbmV3IENvbXBvbmVudCBhbmQgQXBwbGljYXRpb3tbJiomXX1uQ29uZmlndXJhdGlvblxcXCIpCgkJLy8JRXhwZWN0KGs4c0NsaWVudC5DcmVhdGUoY3R4LCAmYW1wO2NvbXBvbmVudCkpLlNob3VsZCh7WyYqJl19U3VjY2VlZCgpKQoJCQlFeHBlY3QoazhzQ2xpZW50LkNyZWF0ZShjdHgsICZhbXA7VHJhaXREZWZpbml0aW9uKSkuU2hvdWxkKFN1Y3tbJiomXX1jZWVkKCkpCgkJCS8vIGFwcGx5IG5ldyBBcHBsaWNhdGlvbkNvbmZpZ3VyYXRpb24gd2l0aCBhIHJldmlzaW9uIGVuYWJsZWQgdHJhe1smKiZdfWl0CgkJCUV4cGVjdChrOHNDbGllbnQuR2V0KGN0eCwgYXBwQ29uZmlnT2JqS2V5LCAmYW1wO2FwcENvbmZpZykpCgkJCWFwcENvbmZ7WyYqJl19aWcuU3BlYy5Db21wb25lbnRzJiM5MTswXS5UcmFpdHMgPSAmIzkxO112MWFscGhhMi5Db21wb25lbnRUcmFpdHt7VHJhaXQ6IHJ1bntbJiomXX10aW1lLlJhd0V4dGVuc2lvbntPYmplY3Q6IHRyYWl0LkRlZXBDb3B5T2JqZWN0KCl9fX0KCQkJRXhwZWN0KGs4c0NsaWVudC5VcGRhe1smKiZdfXRlKGN0eCwgJmFtcDthcHBDb25maWcpKS5TaG91bGQoU3VjY2VlZCgpKQoKCQkJQnkoXFxcImNoZWNrIGN1cnJlbnQgd29ya2xvYWQgZXtbJiomXX14aXN0c1xcXCIpCgkJCXZhciBjdXJyZW50RGVwbG95IHYxLkRlcGxveW1lbnQKCQkJRXZlbnR1YWxseSgKCQkJCWZ1bmMoKSBlcnJvciB7WyYqJl19ewoJCQkJCXJldHVybiBrOHNDbGllbnQuR2V0KGN0eCwgd29ya2xvYWRPYmpLZXksICZhbXA7Y3VycmVudERlcGxveSkKCQkJCX0sCntbJiomXX0JCQkJdGltZS5TZWNvbmQqMTUsIHRpbWUuTWlsbGlzZWNvbmQqNTAwKS5TaG91bGQoQmVOaWwoKSkKCgkJCUJ5KFxcXCJjaGVjayB2ZXJ7WyYqJl19c2lvbiAxIHdvcmtsb2FkIGRvZXNuXFxcJ3QgZXhpc3RcXFwiKQoJCQl2YXIgdjFEZXBsb3kgdjEuRGVwbG95bWVudAoJCQl3b3JrbG9hZE97WyYqJl19YmpLZXkgOj0gY2xpZW50Lk9iamVjdEtleXtOYW1lOiBjb21wb25lbnROYW1lICsgXFxcIi12MVxcXCIsIE5hbWVzcGFjZTogbmFtZXNwYWN7WyYqJl19ZX0KCQkJRXZlbnR1YWxseSgKCQkJCWZ1bmMoKSBlcnJvciB7CgkJCQkJcmV0dXJuIGs4c0NsaWVudC5HZXQoY3R4LCB3b3JrbG9hZHtbJiomXX1PYmpLZXksICZhbXA7djFEZXBsb3kpCgkJCQl9LAoJCQkJdGltZS5TZWNvbmQqMTUsIHRpbWUuTWlsbGlzZWNvbmQqNTAwKS5TaG91e1smKiZdfWxkKEhhdmVPY2N1cnJlZCgpKQoJCX0pCgl9KQpcIjt7WyYqJl19\[\[/code\]\]

\[\[code\]\]czo0NTc6XCIvL0FmdGVyRWFjaCBibG9ja3MgYXJlIHJ1biBhZnRlciBJdCBibG9ja3MuICAgV2hlbiBtdWx0aXBsZSBBZnRlckVhY2h7WyYqJl19IGJsb2NrcyBhcmUgZGVmaW5lZCBpbiBuZXN0ZWQKLy9EZXNjcmliZSBhbmQgQ29udGV4dCBibG9ja3MgdGhlIGlubmVybW9zdCBBZntbJiomXX10ZXJFYWNoIGJsb2NrcyBhcmUgcnVuIGZpcnN0LgovLwovL0xpa2UgSXQgYmxvY2tzLCBBZnRlckVhY2ggYmxvY2tzIGNhbiBiZSBte1smKiZdfWFkZSBhc3luY2hyb25vdXMgYnkgcHJvdmlkaW5nIGEgYm9keSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMKLy9hIERvbmUgY2hhbm5lbAp7WyYqJl19ZnVuYyBBZnRlckVhY2goYm9keSBpbnRlcmZhY2V7fSwgdGltZW91dCAuLi5mbG9hdDY0KSBib29sIHsKCWdsb2JhbC5TdWl0ZS5QdXtbJiomXX1zaEFmdGVyRWFjaE5vZGUoYm9keSwgY29kZWxvY2F0aW9uLk5ldygxKSwgcGFyc2VUaW1lb3V0KHRpbWVvdXQuLi4pKQoJcmV0dXJue1smKiZdfSB0cnVlCn0KXCI7e1smKiZdfQ==\[\[/code\]\]

AfterEach 会在每个 It 后面执行，所以相当于会做一些资源清理的工作。
